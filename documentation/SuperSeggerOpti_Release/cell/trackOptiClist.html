<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of trackOptiClist</title>
  <meta name="keywords" content="trackOptiClist">
  <meta name="description" content="trackOptiClist generates an array called the clist">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerOpti_Release</a> &gt; <a href="index.html">cell</a> &gt; trackOptiClist.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerOpti_Release/cell&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>trackOptiClist
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>trackOptiClist generates an array called the clist</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [clist] = trackOptiClist(dirname,CONST,header) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> trackOptiClist generates an array called the clist
 which contains non time dependent information for each cell.

 INPUT :
   dirname: seg folder eg. maindirectory/xy1/seg
   CONST: segmentation constants
   header : string displayed with information

 Copyright (C) 2016 Wiggins Lab
 University of Washington, 2016
 This file is part of SuperSeggerOpti.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="trackOptiListNeighbor.html" class="code" title="function [clist_tmp] = trackOptiListNeighbor(dirname,CONST,header)">trackOptiListNeighbor</a>	trackOptiListNeighbor : creates a neighbors list for each cell.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function data = loaderInternal( filename );</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [clist] = trackOptiClist(dirname,CONST,header)</a>
0002 <span class="comment">% trackOptiClist generates an array called the clist</span>
0003 <span class="comment">% which contains non time dependent information for each cell.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% INPUT :</span>
0006 <span class="comment">%   dirname: seg folder eg. maindirectory/xy1/seg</span>
0007 <span class="comment">%   CONST: segmentation constants</span>
0008 <span class="comment">%   header : string displayed with information</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0011 <span class="comment">% University of Washington, 2016</span>
0012 <span class="comment">% This file is part of SuperSeggerOpti.</span>
0013 
0014 
0015 <span class="keyword">if</span> ~exist(<span class="string">'header'</span>)
0016     header = [];
0017 <span class="keyword">end</span>
0018 
0019 dirseperator = filesep;
0020 <span class="keyword">if</span>(nargin&lt;1 || isempty(dirname))
0021     
0022     dirname = <span class="string">'.'</span>;
0023     dirname = [dirname,dirseperator];
0024 <span class="keyword">else</span>
0025     <span class="keyword">if</span> dirname(length(dirname))~=dirseperator
0026         dirname = [dirname,dirseperator];
0027     <span class="keyword">end</span>
0028 <span class="keyword">end</span>
0029 
0030 
0031 <span class="comment">% Get the track file names...</span>
0032 contents=dir([dirname <span class="string">'*_err.mat'</span>]);
0033 <span class="keyword">if</span> isempty( contents )
0034     clist.data = [];
0035     clist.def={};
0036     clist.gate=[];
0037 <span class="keyword">else</span>
0038     data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename );">loaderInternal</a>([dirname,contents(end).name]);
0039     MAX_CELL = max(10000, max(data_c.regs.ID) + 100);
0040     num_im = numel(contents);
0041     
0042     <span class="keyword">if</span> CONST.show_status
0043         h = waitbar( 0, <span class="string">'Making Cells.'</span>);
0044     <span class="keyword">else</span>
0045         h = [];
0046     <span class="keyword">end</span>
0047     
0048     clist = [];
0049     clist.def =     { <span class="string">'1: Cell ID'</span>, <span class="keyword">...</span>
0050         <span class="string">'2: Cell Birth Time'</span>, <span class="keyword">...</span>
0051         <span class="string">'3: Cell Division Time'</span>, <span class="keyword">...</span>
0052         <span class="string">'4: Cell Age'</span>, <span class="keyword">...</span>
0053         <span class="string">'5: Cell Dist to edge'</span>, <span class="keyword">...</span>
0054         <span class="string">'6: Old Pole Age'</span>, <span class="keyword">...</span>
0055         <span class="string">'7: Long Axis Birth'</span>, <span class="keyword">...</span>
0056         <span class="string">'8: Long Axis Divide'</span>,<span class="keyword">...</span>
0057         <span class="string">'9: Complete Cell Cycles'</span>,<span class="keyword">...</span>
0058         <span class="string">'10: Short Axis Birth'</span>, <span class="keyword">...</span>
0059         <span class="string">'11: Short Axis Divide'</span>, <span class="keyword">...</span>
0060         <span class="string">'12: Area Birth'</span>, <span class="keyword">...</span>
0061         <span class="string">'13: Area Divide'</span>, <span class="keyword">...</span>
0062         <span class="string">'14: fluor1 sum'</span>, <span class="keyword">...</span>
0063         <span class="string">'15: fluor1 mean'</span>, <span class="keyword">...</span>
0064         <span class="string">'16: fluor2 sum'</span>, <span class="keyword">...</span>
0065         <span class="string">'17: fluor2 mean'</span>, <span class="keyword">...</span>
0066         <span class="string">'18: number of neighbors'</span>,<span class="keyword">...</span>
0067         <span class="string">'19: locus1_1 longaxis'</span>, <span class="keyword">...</span>
0068         <span class="string">'20: locus1_1 shortaxis'</span>,<span class="keyword">...</span>
0069         <span class="string">'21: locus1_1 score'</span>, <span class="keyword">...</span>
0070         <span class="string">'22: locus1_1 Intensity'</span>,<span class="keyword">...</span>
0071         <span class="string">'23: mother ID'</span>,<span class="keyword">...</span>
0072         <span class="string">'24: daughter1 ID'</span>,<span class="keyword">...</span>
0073         <span class="string">'25: daughter2 ID'</span><span class="keyword">...</span>
0074         };
0075     
0076     <span class="comment">% These guys will be updated every frame.</span>
0077     death_ind = [3,4,8,9,11,13,24,25];
0078     
0079     clist_tmp = nan( MAX_CELL, numel( clist.def) );
0080     clist_tmp(:,1) = 0;
0081     
0082     <span class="comment">%initialize case neighbor flag is not set</span>
0083     share_pole = [];
0084     
0085     <span class="comment">% loop through all the cells.</span>
0086     <span class="keyword">for</span> i = 1:num_im
0087         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename );">loaderInternal</a>([dirname,contents(i  ).name]);
0088         <span class="comment">% record the number of cell neighbors</span>
0089         <span class="keyword">if</span> CONST.trackOpti.NEIGHBOR_FLAG &amp;&amp; <span class="keyword">...</span>
0090                 ~isfield( data_c.CellA{1}, <span class="string">'numNeighbors'</span> )
0091             <span class="keyword">for</span> ii = 1:data_c.regs.num_regs
0092                 nei_ = numel(trackOptiNeighbors(data_c,ii));
0093                 <span class="comment">%data_c.regs.numNeighbors{ii} = nei_ ;</span>
0094                 data_c.CellA{ii}.numNeighbors = nei_ ;
0095             <span class="keyword">end</span>
0096         <span class="keyword">end</span>
0097         
0098         
0099         <span class="comment">% SWITCH LOCUS POSITIONS TO BE ALIGNED TO OLD AND NEW POLES (OLD =</span>
0100         <span class="comment">% POSITIVE</span>
0101         <span class="keyword">if</span> isfield(CONST.trackOpti,<span class="string">'pole_flag'</span>) &amp;&amp; CONST.trackOpti.pole_flag == 1       
0102             data_c = getNeighborPole(data_c) ;
0103             share_pole = drill( data_c.CellA, <span class="string">'.neighbor_pole'</span>);
0104             data_c = pole_direction(data_c); 
0105         <span class="keyword">end</span>
0106         
0107         
0108         <span class="comment">% figure out which cells are new born.</span>
0109         maxID = max( clist_tmp(:,1) );
0110         ID = data_c.regs.ID;
0111         bci = (ID&gt;maxID);
0112         ci = and( ~bci, logical(ID) );
0113         
0114         IDnz = ID(ID&gt;0);
0115         IDlog = ID&gt;0;
0116         
0117         lold     = nan(1,numel(ID));
0118         lbirth   = nan(1,numel(ID));
0119         dlmaxOld = nan(1,numel(ID));
0120         dlminOld = nan(1,numel(ID));
0121         
0122         
0123         lold(    IDlog) = clist_tmp(IDnz,8);
0124         lbirth(  IDlog) = clist_tmp(IDnz,7);
0125         <span class="comment">%dlmaxOld(IDlog) = clist_tmp(IDnz,68);</span>
0126         <span class="comment">%dlminOld(IDlog) = clist_tmp(IDnz,69);</span>
0127         
0128         regnum = (1:data_c.regs.num_regs)';
0129         zz = zeros( data_c.regs.num_regs, 1);
0130         
0131         cell_dist = drill( data_c.CellA, <span class="string">'.cell_dist'</span>);
0132         pole_age  = drill( data_c.CellA, <span class="string">'.pole.op_age'</span>);
0133         fl1       = drill( data_c.CellA, <span class="string">'.fl1.sum'</span> );
0134         fl2       = drill( data_c.CellA, <span class="string">'.fl2.sum'</span> );
0135         Area      = drill( data_c.CellA, <span class="string">'.coord.A'</span> );
0136         xpos      = drill( data_c.CellA, <span class="string">'.coord.rcm(1)'</span> );
0137         ypos      = drill( data_c.CellA, <span class="string">'.coord.rcm(2)'</span> );
0138         nei       = drill( data_c.CellA, <span class="string">'.numNeighbors'</span>);
0139         gray      = drill( data_c.CellA, <span class="string">'.gray'</span>);
0140         
0141         l11_L1    = drill( data_c.CellA, <span class="string">'.locus1(1).longaxis'</span> );
0142         l11_L2    = drill( data_c.CellA, <span class="string">'.locus1(1).shortaxis'</span> );
0143         l11_s     = drill( data_c.CellA, <span class="string">'.locus1(1).score'</span> );
0144         l11_i     = drill( data_c.CellA, <span class="string">'.locus1(1).intensity'</span> );
0145         
0146         l12_L1    = drill( data_c.CellA, <span class="string">'.locus1(2).longaxis'</span> );
0147         l12_L2    = drill( data_c.CellA, <span class="string">'.locus1(2).shortaxis'</span> );
0148         l12_s     = drill( data_c.CellA, <span class="string">'.locus1(2).score'</span> );
0149         l12_i     = drill( data_c.CellA, <span class="string">'.locus1(2).intensity'</span> );
0150         
0151         l13_L1    = drill( data_c.CellA, <span class="string">'.locus1(3).longaxis'</span> );
0152         l13_L2    = drill( data_c.CellA, <span class="string">'.locus1(3).shortaxis'</span> );
0153         l13_s     = drill( data_c.CellA, <span class="string">'.locus1(3).score'</span> );
0154         l13_i     = drill( data_c.CellA, <span class="string">'.locus1(3).intensity'</span> );
0155         
0156         l14_L1    = drill( data_c.CellA, <span class="string">'.locus1(4).longaxis'</span> );
0157         l14_L2    = drill( data_c.CellA, <span class="string">'.locus1(4).shortaxis'</span> );
0158         l14_s     = drill( data_c.CellA, <span class="string">'.locus1(4).score'</span> );
0159         l14_i     = drill( data_c.CellA, <span class="string">'.locus1(4).intensity'</span> );
0160         
0161         l15_L1    = drill( data_c.CellA, <span class="string">'.locus1(5).longaxis'</span> );
0162         l15_L2    = drill( data_c.CellA, <span class="string">'.locus1(5).shortaxis'</span> );
0163         l15_s     = drill( data_c.CellA, <span class="string">'.locus1(5).score'</span> );
0164         l15_i     = drill( data_c.CellA, <span class="string">'.locus1(5).intensity'</span> );
0165         
0166         da1_i     = drill(data_c.regs.daughterID,<span class="string">'(1)'</span>);
0167         da2_i     = drill(data_c.regs.daughterID,<span class="string">'(2)'</span>);
0168         
0169         l1_Lsc    = (2*l11_L1)./drill( data_c.CellA, <span class="string">'.length(1)'</span> );
0170         l2_Lsc    = (2*l12_L1)./drill( data_c.CellA, <span class="string">'.length(1)'</span> );
0171         l3_Lsc    = (2*l13_L1)./drill( data_c.CellA, <span class="string">'.length(1)'</span> );
0172         l4_Lsc    = (2*l14_L1)./drill( data_c.CellA, <span class="string">'.length(1)'</span> );
0173         l5_Lsc    = (2*l15_L1)./drill( data_c.CellA, <span class="string">'.length(1)'</span> );
0174         
0175         l1_lsc    = (2*l11_L2)./drill( data_c.CellA, <span class="string">'.length(2)'</span> );
0176         l2_lsc    = (2*l12_L2)./drill( data_c.CellA, <span class="string">'.length(2)'</span> );
0177         l3_lsc    = (2*l13_L2)./drill( data_c.CellA, <span class="string">'.length(2)'</span> );
0178         l4_lsc    = (2*l14_L2)./drill( data_c.CellA, <span class="string">'.length(2)'</span> );
0179         l5_lsc    = (2*l15_L2)./drill( data_c.CellA, <span class="string">'.length(2)'</span> );
0180         
0181         l1_w      = drill( data_c.CellA,<span class="string">'.locus1(1).b'</span>);
0182         l2_w      = drill( data_c.CellA,<span class="string">'.locus1(2).b'</span>);
0183         l3_w      = drill( data_c.CellA,<span class="string">'.locus1(3).b'</span>);
0184         
0185         <span class="keyword">if</span> CONST.trackOpti.LYSE_FLAG
0186             
0187             errorColor1Cum = data_c.regs.lyse.errorColor1Cum;
0188             errorColor2Cum = data_c.regs.lyse.errorColor2Cum;
0189             errorShapeCum  = data_c.regs.lyse.errorShapeCum;
0190             
0191             errorColor1bCum = data_c.regs.lyse.errorColor1bCum;
0192             errorColor2bCum = data_c.regs.lyse.errorColor2bCum;
0193         <span class="keyword">else</span>
0194             errorColor1Cum  = nan(size(ID));
0195             errorColor2Cum  = nan(size(ID));
0196             errorShapeCum   = nan(size(ID));
0197             
0198             errorColor1bCum = nan(size(ID));
0199             errorColor2bCum = nan(size(ID));
0200         <span class="keyword">end</span>
0201         
0202         
0203         <span class="comment">%         lnew = data_c.regs.L1;</span>
0204         <span class="comment">%</span>
0205         <span class="comment">%         dl = (lnew-lold);</span>
0206         <span class="comment">%</span>
0207         <span class="comment">%         dlmin = nan( size( dl ) );</span>
0208         <span class="comment">%         dlmax = nan( size( dl ) );</span>
0209         <span class="comment">%</span>
0210         <span class="comment">%         indTmp = isnan(dlminOld);</span>
0211         <span class="comment">%         dlmin( indTmp ) = dl( indTmp );</span>
0212         <span class="comment">%</span>
0213         <span class="comment">%         indTmp = isnan(dlmaxOld);</span>
0214         <span class="comment">%         dlmax( indTmp ) = dl( indTmp );</span>
0215         <span class="comment">%</span>
0216         <span class="comment">%         indTmp = isnan(dl);</span>
0217         <span class="comment">%         dlmin( indTmp ) = dlminOld( indTmp );</span>
0218         <span class="comment">%         dlmax( indTmp ) = dlmaxOld( indTmp );</span>
0219         <span class="comment">%</span>
0220         <span class="comment">%         indTmp = ~isnan(dl+dlminOld);</span>
0221         <span class="comment">%         dlmin( indTmp ) = min( [dl( indTmp );dlminOld( indTmp )] );</span>
0222         <span class="comment">%</span>
0223         <span class="comment">%         indTmp = ~isnan(dl+dlmaxOld);</span>
0224         <span class="comment">%         dlmax( indTmp ) = max( [dl( indTmp );dlmaxOld( indTmp )] );</span>
0225         <span class="comment">%</span>
0226         <span class="comment">%         lrel = lnew./lbirth;</span>
0227         
0228         tmp = [ ID', <span class="keyword">...</span>
0229             i + zz, <span class="keyword">...</span>
0230             i + zz, <span class="keyword">...</span>
0231             i - data_c.regs.birth', <span class="keyword">...</span>
0232             cell_dist', <span class="keyword">...</span>
0233             pole_age', <span class="keyword">...</span>
0234             data_c.regs.L1', <span class="keyword">...</span>
0235             data_c.regs.L1', <span class="keyword">...</span>
0236             data_c.regs.stat0', <span class="keyword">...</span>
0237             data_c.regs.L2', <span class="keyword">...</span>
0238             data_c.regs.L2', <span class="keyword">...</span>
0239             Area',<span class="keyword">...</span>
0240             Area',<span class="keyword">...</span>
0241             fl1',<span class="keyword">...</span>
0242             fl1'./Area',<span class="keyword">...</span>
0243             fl2',<span class="keyword">...</span>
0244             fl2'./Area',<span class="keyword">...</span>
0245             nei',<span class="keyword">...</span>
0246             l11_L1',<span class="keyword">...</span>
0247             l11_L2',<span class="keyword">...</span>
0248             l11_s',<span class="keyword">...</span>
0249             l11_i',<span class="keyword">...</span>
0250             data_c.regs.motherID',<span class="keyword">...</span>
0251             da1_i',<span class="keyword">...</span>
0252             da2_i'<span class="keyword">...</span>
0253             ];
0254         
0255         <span class="comment">% these are the guys that are set at birth</span>
0256         <span class="keyword">try</span>
0257             clist_tmp( ID(bci), : ) = tmp( bci, :);
0258         <span class="keyword">catch</span>
0259             <span class="string">'help'</span>
0260         <span class="keyword">end</span>
0261         <span class="comment">% update guys that you want to set to the death value</span>
0262         clist_tmp( ID(ci), death_ind ) = tmp( ci, death_ind );
0263         
0264         <span class="keyword">if</span> CONST.show_status
0265             waitbar(i/num_im,h,[<span class="string">'Clist--Frame: '</span>,num2str(i),<span class="string">'/'</span>,num2str(num_im)]);
0266         <span class="keyword">else</span>
0267             disp([header, <span class="string">'Clist frame: '</span>,num2str(i),<span class="string">' of '</span>,num2str(num_im)]);
0268         <span class="keyword">end</span>
0269         
0270         
0271     <span class="keyword">end</span>
0272     
0273     <span class="comment">% save the updated err files.</span>
0274     
0275     
0276     <span class="keyword">if</span> CONST.show_status
0277         close(h);
0278     <span class="keyword">end</span>
0279     
0280     
0281     
0282     clist.data = clist_tmp(logical(clist_tmp(:,1)),:);
0283     clist.gate = CONST.trackLoci.gate;
0284     clist.neighbor = [];
0285     
0286     <span class="keyword">if</span> CONST.trackOpti.NEIGHBOR_FLAG
0287         clist.neighbor = <a href="trackOptiListNeighbor.html" class="code" title="function [clist_tmp] = trackOptiListNeighbor(dirname,CONST,header)">trackOptiListNeighbor</a>(dirname,CONST,[]);
0288     <span class="keyword">end</span>
0289 <span class="keyword">end</span>
0290 <span class="keyword">end</span>
0291 
0292 <a name="_sub1" href="#_subfunctions" class="code">function data = loaderInternal( filename );</a>
0293 data = load( filename );
0294 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 13:44:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>